<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gempa Bumi - SeismoTech</title>
    <link rel="stylesheet" href="/CSS/dashboard.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Header & Hero Section Combined -->
    <section class="hero-section">
        <!-- Navigation -->
        <header class="navbar">
            <div class="nav-container">
                <div class="logo">SeismoTech</div>
                <nav class="nav-menu">
                    <a href="#beranda" class="nav-link">Beranda</a>
                    <a href="#gempa" class="nav-link">Gempa</a>
                    <a href="#dampak" class="nav-link">Dampak</a>
                    <a href="#pencegahan" class="nav-link">Pencegahan</a>
                    <a href="#informasi" class="nav-link">Informasi</a>
                </nav>
            </div>
        </header>

        <!-- Hero Content -->
        <div class="hero-content">
            <div>
                <h1>Gempa Bumi</h1>
                <p>Gempa bumi merupakan gejala alam yang ditimbulkan oleh tiba-tiba bergeraknya lempeng tektonik di dalam bumi. Gempa bumi dapat terjadi karena adanya pergerakan magma di dalam bumi, namun penyebab utama adalah kegiatan pergerakan lempeng tektonik bumi yang terus bergerak di atas mantel bumi yang panas.</p>
            </div>
        </div>

        <div class="hero-overlay"></div>
    </section>

    <!-- Jenis-Jenis Gempa Section -->
    <section id="jenis-gempa" class="jenis-gempa-section">
        <h2>Jenis-Jenis Gempa</h2>
        <div class="gempa-cards">
            <div class="card">
                <div class="card-image tektonik">
                    <img src="/assets/tektonik.png" alt="">
                    <h3>Gempa Tektonik</h3>
                </div>
            </div>
            <div class="card">
                <div class="card-image vulkanik">
                    <img src="/assets/vulkanik.png" alt="">
                    <h3>Gempa Vulkanik</h3>
                </div>
            </div>
            <div class="card">
                <div class="card-image buatan">
                    <img src="/assets/buatan.png" alt="">
                    <h3>Gempa Buatan</h3>
                </div>
            </div>
        </div>
    </section>

    <!-- Dampak Section -->
    <section id="dampak" class="dampak-section">
        <h2>Dampak</h2>
        <div class="dampak-container">
            <div class="dampak-item dampak-positif">
                <div class="dampak-image positif"></div>
                <div class="dampak-content">
                    <h3>Dampak Positif</h3>
                    <p>Mengurangi jumlah gas dalam lapisan (intes) di dari reaktor. Membantu menahan gerakan terhadap beban tekanan. Memberikan data dan informasi alam untuk pelintasan. Meningkatkan penggunaan energi konvensional</p>
                </div>
            </div>
            
            <div class="dampak-divider"></div>

            <div class="dampak-item dampak-negatif">
                <div class="dampak-content">
                    <h3>Dampak Negatif</h3>
                    <p>Merusak bangunan-bangunan di lokasi, kerusakan bangunan dan infrastruktur, banyak bangunan pertokoan rusakan tidak dapat digunakan. Korban jiwa dapat terjadi.</p>
                </div>
                <div class="dampak-image negatif"></div>
            </div>
        </div>
    </section>

    <!-- Perencanaan Tindakan Bencana -->
    <section id="pencegahan" class="pencegahan-section">
        <h2>Perencanaan Tindakan Bencana Gempa Bumi</h2>
        <p>Kita dapat Persiapkan dengan rekonstruksi dan pengorganisasian baik itu persiapan sebelum gempa terjadi</p>
        <button class="btn-perencanaan">Selengkapnya ></button>
    </section>

    <!-- Informasi Gempa Real-Time -->
    <section id="informasi" class="informasi-section">
        <div class="info-header">
            <h2>Informasi Gempa Bumi Real-Time</h2>
            <div class="refresh-info">
                <button class="btn-refresh" onclick="loadGempaData()">
                    <span class="refresh-icon">↻</span> Refresh
                </button>
                <span class="last-update" id="last-update">Terakhir diperbarui: -</span>
            </div>
        </div>
        <div class="peta-gempa">
            <div class="peta-loading" id="peta-loading">
                <div class="loading-spinner"></div>
                <p>Memuat peta gempa...</p>
            </div>
            <img id="peta-img" src="assets/perencanaa.png" alt="Peta Gempa Indonesia" style="display: none;">
        </div>
    </section>

    <!-- Tabel Beberapa Gempa -->
    <section class="tabel-gempa-section">
        <h2>Beberapa Gempa Bumi Real-Time</h2>
        <div class="tabel-wrapper">
            <div id="tabel-status" class="tabel-loading">
                <div class="loading-spinner"></div>
                <p>Memuat data gempa...</p>
            </div>
            <table class="tabel-gempa" id="tabel-gempa" style="display: none;">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Waktu</th>
                        <th>Lokasi</th>
                        <th>Magnitudo</th>
                        <th>Kedalaman</th>
                        <th>Koordinat</th>
                        <th>Wilayah</th>
                    </tr>
                </thead>
                <tbody id="tabel-body">
                </tbody>
            </table>
        </div>
    </section>

    <!-- Dibalik Layar Section -->
    <section class="dibalik-layar-section">
        <h2>Dibalik Layar</h2>
        <div class="dibalik-container">
            <div class="dibalik-item">
                <div class="dibalik-label">Tectik</div>
            </div>
            <div class="dibalik-item">
                <div class="dibalik-label">Kime</div>
            </div>
            <div class="dibalik-item">
                <div class="dibalik-label">Alimito</div>
            </div>
            <div class="dibalik-item">
                <div class="dibalik-label">Togo</div>
            </div>
            <div class="dibalik-item">
                <div class="dibalik-label">Argel</div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="kata-kata">
            <h3>Kata - Kata</h3>
            <p>"Sensing The Earth, Securing The Future"</p>
        </div>
        <div class="copyright">
            <p>Copyright 2025. All rights Reserved</p>
        </div>
    </footer>

    <script>
        // Fungsi untuk update waktu terakhir refresh
        function updateLastRefreshTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('id-ID', { 
                hour: '2-digit', 
                minute: '2-digit',
                second: '2-digit'
            });
            document.getElementById('last-update').textContent = `Terakhir diperbarui: ${timeString}`;
        }

        // Fungsi untuk fetch data gempa dari API BMKG
        async function loadGempaData() {
            try {
                // Tambahkan timestamp untuk force refresh dan hindari cache
                const timestamp = new Date().getTime();
                
                // URL API yang benar untuk gempa terkini dengan cache buster
                const response = await fetch(`https://data.bmkg.go.id/DataMKG/TEWS/autogempa.json?t=${timestamp}`, {
                    cache: 'no-cache',
                    headers: {
                        'Cache-Control': 'no-cache',
                        'Pragma': 'no-cache'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                
                // Tampilkan peta shakemap
                if (data.Infogempa && data.Infogempa.gempa && data.Infogempa.gempa.Shakemap) {
                    const imageUrl = `https://data.bmkg.go.id/DataMKG/TEWS/${data.Infogempa.gempa.Shakemap}?t=${timestamp}`;
                    document.getElementById('peta-img').src = imageUrl;
                    document.getElementById('peta-img').style.display = 'block';
                    document.getElementById('peta-loading').style.display = 'none';
                }

                // Ambil data gempa terkini
                const gempaTerkini = data.Infogempa.gempa;
                
                // Array untuk menyimpan semua data gempa
                let gempaList = [];
                
                // Tambahkan gempa terkini ke list
                if (gempaTerkini) {
                    gempaList.push(gempaTerkini);
                }

                // Ambil data gempa tambahan (15 gempa terbaru) dengan cache buster
                try {
                    const response2 = await fetch(`https://data.bmkg.go.id/DataMKG/TEWS/gempaterkini.json?t=${timestamp}`, {
                        cache: 'no-cache',
                        headers: {
                            'Cache-Control': 'no-cache',
                            'Pragma': 'no-cache'
                        }
                    });
                    if (response2.ok) {
                        const data2 = await response2.json();
                        if (data2.Infogempa && data2.Infogempa.gempa) {
                            const gempaArray = Array.isArray(data2.Infogempa.gempa) 
                                ? data2.Infogempa.gempa 
                                : [data2.Infogempa.gempa];
                            // Tambahkan gempa lainnya (maksimal 9 untuk total 10)
                            gempaList.push(...gempaArray.slice(0, 9));
                        }
                    }
                } catch (err) {
                    console.log('Info: Hanya menampilkan gempa terkini');
                }

                // Batasi hingga 10 gempa
                const gempaBatasSepuluh = gempaList.slice(0, 10);

                if (gempaBatasSepuluh.length === 0) {
                    document.getElementById('tabel-status').innerHTML = '<p>Tidak ada data gempa tersedia</p>';
                    return;
                }

                // Populate tabel
                const tbody = document.getElementById('tabel-body');
                tbody.innerHTML = '';

                gempaBatasSepuluh.forEach((gempa, index) => {
                    const row = document.createElement('tr');
                    
                    // Parse data gempa
                    const tanggal = gempa.Tanggal || 'N/A';
                    const jam = gempa.Jam || 'N/A';
                    const lokasi = gempa.Wilayah || 'N/A';
                    const magnitudo = parseFloat(gempa.Magnitude) || 0;
                    const kedalaman = gempa.Kedalaman || 'N/A';
                    const lintang = gempa.Lintang || gempa.Coordinates || 'N/A';
                    const bujur = gempa.Bujur || 'N/A';
                    
                    // Tentukan class magnitudo
                    let magClass = 'magnitudo-low';
                    if (magnitudo >= 6) {
                        magClass = 'magnitudo-high';
                    } else if (magnitudo >= 5) {
                        magClass = 'magnitudo-medium';
                    }

                    row.innerHTML = `
                        <td>${index + 1}</td>
                        <td>${tanggal} ${jam}</td>
                        <td>${lokasi}</td>
                        <td><span class="magnitudo-badge ${magClass}">${magnitudo}</span></td>
                        <td>${kedalaman}</td>
                        <td>${lintang}°, ${bujur}°</td>
                        <td>${gempa.Wilayah || 'N/A'}</td>
                    `;
                    
                    tbody.appendChild(row);
                });

                // Tampilkan tabel dan sembunyikan loading
                document.getElementById('tabel-gempa').style.display = 'table';
                document.getElementById('tabel-status').style.display = 'none';

                // Update waktu terakhir refresh
                updateLastRefreshTime();

            } catch (error) {
                console.error('Error:', error);
                document.getElementById('tabel-status').innerHTML = `<div class="tabel-error">⚠️ Gagal memuat data gempa. Silakan refresh halaman.</div>`;
                document.getElementById('peta-loading').innerHTML = '<p>Gagal memuat peta. Menampilkan peta default...</p>';
                document.getElementById('peta-img').style.display = 'block';
            }
        }

        // Load data saat halaman selesai
        document.addEventListener('DOMContentLoaded', loadGempaData);

        // Auto-refresh data setiap 2 menit (120000 ms)
        setInterval(loadGempaData, 120000);
    </script>
</body>
</html>